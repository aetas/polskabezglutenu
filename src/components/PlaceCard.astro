---
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"

export interface Props {
    nazwa: string;
    opis: string;
    miejscowość: string;
    adres: string;
    www?: string;
    'tylko-bezglutenowe': string;
    kategorie?: string[];
    id: string;
}

const {
    nazwa,
    opis,
    miejscowość,
    adres,
    www,
    'tylko-bezglutenowe': tylkoBezglutenowe,
    kategorie = []
} = Astro.props;

// Format description paragraphs
const opisParagraphs = opis.trim().length > 300
    ? [`${opis.trim().slice(0, 300)}...`]
    : opis.trim().split('\n\n');

// Ensure URL has protocol
const formatUrl = (url: string) => {
    if (!url) return '';
    return url.startsWith('http') ? url : `https://${url}`;
};

const formattedWww = www ? formatUrl(www) : '';
---

<Card>
    <CardHeader className="flex flex-col gap-2">
        {kategorie.length > 0 && (
            <div class="flex flex-wrap gap-2">
                {kategorie.map(kategoria => (
                    <Badge variant="outline">{kategoria}</Badge>
                ))}
            </div>
        )}
        <CardTitle className="font-bold text-xl mt-2">
            {nazwa}
        </CardTitle>
    </CardHeader>
    <CardContent>
        <div class="space-y-4">
            <div class="text-muted-foreground">
                {opisParagraphs.map(paragraph => (
                    <p class="mb-4 last:mb-0">{paragraph.trim()}</p>
                ))}
            </div>
            <div class="space-y-2 text-sm">
                <p><span class="font-semibold">Miejscowość:</span> {miejscowość}</p>
                <p><span class="font-semibold">Adres:</span> {adres}</p>
                {www && (
                    <p>
                        <span class="font-semibold">WWW:</span>
                        <a href={formattedWww} target="_blank" rel="noopener noreferrer" class="ml-1 text-primary hover:underline">{www}</a>
                    </p>
                )}
                <p>
                    <span class="font-semibold">Tylko bezglutenowe:</span>
                    <span class="ml-1">{tylkoBezglutenowe}</span>
                </p>
            </div>
        </div>
    </CardContent>
</Card>
