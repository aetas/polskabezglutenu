---
import '@/styles/globals.css'
import Layout from '../layouts/Layout.astro';
import PlaceCard from '../components/PlaceCard.astro';
import yaml from 'js-yaml';
import fs from 'fs';
import path from 'path';

const daneDir = 'dane';
const places = [];

try {
	const files = fs.readdirSync(daneDir).filter(file => file.endsWith('.yaml'));
	console.log(`[DEBUG_LOG] Found ${files.length} YAML files in ${daneDir} directory`);

	for (const file of files) {
		try {
			const filePath = path.join(daneDir, file);
			const content = fs.readFileSync(filePath, 'utf8');
			const data = yaml.load(content);
			console.log(`[DEBUG_LOG] Successfully loaded ${file}: ${data.nazwa}`);
			places.push({ ...data, id: file.replace('.yaml', '') });
		} catch (error) {
			console.error(`[DEBUG_LOG] Error processing file ${file}:`, error);
		}
	}
} catch (error) {
	console.error(`[DEBUG_LOG] Error reading directory ${daneDir}:`, error);
}
---

<Layout
	title="Polska Bez Glutenu - Lista Miejsc"
	description="Lista miejsc przyjaznych osobom na diecie bezglutenowej w Polsce. Restauracje, kawiarnie, piekarnie i inne lokale z ofertą bezglutenową."
>
	<main class="container mx-auto px-4 py-8 md:px-8">
		<h1 class="mb-8 text-center text-4xl font-bold tracking-tight text-foreground">
			Polska Bez Glutenu
		</h1>
		<p class="mb-8 text-center text-lg text-muted-foreground">
			Lista miejsc przyjaznych osobom na diecie bezglutenowej
		</p>
		<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
			{places.map(place => (
				<PlaceCard {...place} />
			))}
		</div>
	</main>
</Layout>
